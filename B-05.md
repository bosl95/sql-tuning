# 요구 사항

> 서울대병원에 다닌 30대 환자들을 운동 횟수별로 집계하세요

```sql
subway> select p.exercise, count(p.id) as count
        from covid c
            join (select id from hospital where name='서울대병원') h on h.id = c.hospital_id
            join member m on c.member_id = m.id and m.age between 30 and 39
            join programmer p on p.id = c.programmer_id
        group by p.exercise
[2021-11-21 22:06:30] 5 rows retrieved starting from 1 in 155 ms (execution: 147 ms, fetching: 8 ms)
```

| id | select\_type | table | partitions | type | possible\_keys | key | key\_len | ref | rows | filtered | Extra |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | SIMPLE | h | NULL | index | I\_id\_name | I\_id\_name | 1028 | NULL | 32 | 10 | Using where; Using index; Using temporary; Using filesort |
| 1 | SIMPLE | c | NULL | ALL | NULL | NULL | NULL | NULL | 315397 | 10 | Using where; Using join buffer \(Block Nested Loop\) |
| 1 | SIMPLE | p | NULL | ref | I\_id\_member\_id\_hobby\_country | I\_id\_member\_id\_hobby\_country | 9 | subway.c.programmer\_id | 1 | 100 | NULL |
| 1 | SIMPLE | m | NULL | ref | I\_id\_age | I\_id\_age | 5 | subway.c.member\_id | 1 | 11.11 | Using where; Using index |

<br>

- coivd에 member_id 인덱스를 추가하고, covid 인덱스 순서에 맞게 join 순서를 변경해보았다. 약간의 차이점은 있는 것으로 보인다. (covide의 type이 ALL => index로 변경)

```sql
subway> select p.exercise, count(p.id) as count
        from covid c
                 join programmer p on c.programmer_id = p.id
                 join hospital h on c.hospital_id = h.id and h.name = '서울대병원'
                 join member m on c.member_id = m.id and m.age between 30 and 39
        
        group by p.exercise
[2021-11-21 22:43:56] 5 rows retrieved starting from 1 in 138 ms (execution: 126 ms, fetching: 12 ms)
```


| id | select\_type | table | partitions | type | possible\_keys | key | key\_len | ref | rows | filtered | Extra |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | SIMPLE | h | NULL | index | I\_id\_name | I\_id\_name | 1028 | NULL | 32 | 10 | Using where; Using index; Using temporary; Using filesort |
| 1 | SIMPLE | c | NULL | index | NULL | I\_id\_programmer\_id\_hospital\_id\_member\_id | 36 | NULL | 315397 | 10 | Using where; Using index; Using join buffer \(Block Nested Loop\) |
| 1 | SIMPLE | p | NULL | ref | I\_id\_member\_id\_hobby\_country | I\_id\_member\_id\_hobby\_country | 9 | subway.c.programmer\_id | 1 | 100 | NULL |
| 1 | SIMPLE | m | NULL | ref | I\_id\_age | I\_id\_age | 5 | subway.c.member\_id | 1 | 11.11 | Using where; Using index |
